
The scripts provided in this folder are taken from the Jupyter Notebooks stored on the **bs-jupyterhub05** VM. 
They have been migrated to Python scripts.
The goal is to generate plots for the wastewater reporting e-mails, as well as to filter or reformat the JSON 
file output generated by **lollipop**.

# Make relative abundance curves of COVID variants (`ww_cov_curves_v-pipe.py`)

This script processes and visualizes smoothed time-series data on SARS-CoV-2 variant proportions across 
Swiss locations (`deconvoluted_upload.json`). 
It loads configuration and input data, filters variant trends by location-specific start dates, 
and ensures all variants are properly mapped to colors. The script then generates multi-panel plots of 
recent variant dynamics with confidence intervals and exports the cleaned data in three JSON formats: 
for general use, CovSpectrum upload (excluding blacklisted entries), and FOPH/BAG Polybox submission.

# `merge_json.py`

This script merges new results with historical data (including discontinued treatment plants) 
to generate the complete JSON for upload to **WiseDB**.

# Make Switzerland map for communication (`w_cov_switzerland_map.py`)

This script generates a Swiss map visualizing SARS-CoV-2 variant proportions across 
selected wastewater treatment plant catchment areas. It loads geographic shapefiles, 
demographic data, and variant deconvolution results from a YAML-configured pipeline. 
The script filters data from the most recent week, calculates average variant proportions per location, 
and draws population-scaled pie charts over the corresponding catchment areas. It overlays cantonal boundaries, 
lakes, and municipalities for geographic context, and includes a dynamically sorted legend 
showing prevalent variants. The final map is saved in PNG, SVG, and PDF formats for communication 
or reporting purposes.

# Upload results (`ww_cov_uploader_v-pipe.py`)

This script automates the upload of processed SARS-CoV-2 wastewater variant data to multiple platforms. 
It connects to the CovSpectrum database and updates or 
inserts variant time series for each location. It then compresses the combined JSON dataset, 
computes a SHA-256 checksum, and uploads the file to WiseDB. 
Lastly, it uploads the dataset and its reformatted version to both the FOPH/BAG Polybox and a public 
Polybox folder.
